---
title: 基于PID的网络温控仪设计
date: 2021-03-02
categories:
- 技术
tags:
- 技术
mathjax: true
---





# 基于PID的网络温控仪设计

> 没有无线电，世界是聋的。——尔奈斯特 雅伯

在正式开始前，我想先请各位扫描一下二维码：

![25_734_186d36a414a8404516274f852a77bc7f_203b3b133ed0debbfbb9a88a90c55ed3](https://gitee.com/DF-Master/yidapicbed/raw/master/20210305021006.png)![25_734_186d36a414a8404516274f852a77bc7f_203b3b133ed0debbfbb9a88a90c55ed3](https://gitee.com/DF-Master/yidapicbed/raw/master/20210305020959.png)

<center><font color="gray">↑ <p>前者是公网链接，后者的是内网链接，后者更快,需要连接内网（北大校园网）。</p>
    数据无更新可能是出于安全考虑关闭了加热装置。</font></center>

如果你不方便连接[外网](http://379w07117o.qicp.vip/)或[内网](http://10.128.190.4:8501/)网址，我这里也准备了几张截图：

![image-20210304164326388](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210304164326388.png)

<center><font color="gray">↑ <p>因为经验有限，效率不高，所以目前的网站只包括一些简单的功能：</p><p>1. 作者的信息和联系方式; 
    2. 仪器的默认设定参数（可以在服务器端更改）; 
    3. 当前的实时数据
    </p></font></center>

如果你需要实时监控温度的变化，还有以下功能：

![image-20210304165010207](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210304165010207.png)

<center><font color="gray">↑ 需要监控的数据长度也可以在服务器更改
    </p></font></center>

总结一下，我的主要工作是：

- 通过PID温控仪实现了最高$\pm\,0.1\,^\circ $C的精确控温
- 将温控器的温度数据通过RS485串口与无线数传电台远程发送至服务器
- 将服务器数据用python进行可视化读取并生成网页，发送至内网
- 将内网网站部署到公网，实现实时各地自由访问

至于最终呈现的效果，诸位已经可以直观地看到了。那么我为何要做这个工作，又是如何实现的呢？请听我娓娓道来。

我使用的[工具](#我的工具)放在文末，如果你感兴趣或者有任何意见或建议的话，也可以[联系我](http://yidajiang.top/2021/02/15/about/)。

## 项目动机

在能源逐渐出现危机的当下，核电逐渐受到人们的关注，核废料的处理也因此成为人们日益关注的话题。例如，对第四代反应堆中的**熔盐反应堆**（molten salt reactor, MSR）中涉及的大量Li盐的回收，就具有相当重要的经济、政治、环境意义。    *!!此处应有文献补充*

![img](https://gitee.com/DF-Master/yidapicbed/raw/master/ARE_Building.JPG)

<center><font color="gray">↑ 橡树岭国家实验室（Oak Ridge National Laboratory, ORNL）的飞行器反应堆试验楼，后来它为熔盐堆试验而改建。
    </p></font></center>

目前，我们已经了解到两种潜在的Li盐捕获剂**A1**(Sudan I)与**B1**(4,4,4-trifluoro-1-(naphthalen-2-yl)butane-1,3-dione)可能是潜在的Li捕获剂。为了解两种分子配合物的结构，我们考虑从理论计算、红外光谱、二维红外光谱三方面分析其特征。*!!此处应有文献补充*

![image-20210304232934783](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210304232934783.png)

<center><font color="gray">↑ A1、B1的结构与外观
    </p></font></center>

在最初的实验中，我发现，B的配合物的红外光谱难以辨别出特征峰。

![image-20210304233645868](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210304233645868.png)

<center><font color="gray">↑ B1及其Li配合物溶液的FTIR结果  ！！图表结果需要优化
    </p></font></center>

而A的配合物的红外光谱虽然可以辨别出1360、1564 cm<sup>-1</sup>处的特征峰，但在HCCl<sub>3</sub>的饱和溶液中，信号仍然较弱。

![image-20210304233551982](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210304233551982.png)

<center><font color="gray">↑ A1及其Li配合物溶液的FTIR结果  ！！图表结果需要优化
    </p></font></center>

在反复尝试DCM、HCCl<sub>4</sub>、THF等溶剂体系后，我们仍然无法取得较强的配合物FTIR特征峰信号。因此，我们选择了全新的方法——通过加热至熔点，将熔融**A1**与**B1**作为溶剂溶解配合物，以最大可能地提高配合物溶解度并且使其仍然具有转动活性。但目前的FTIR装置是未添加加热模块的，所以设计一个安全可控、廉价稳定温控仪便成为我们的一项工作目标。

## 分析需求

在开始我的工作前，我确立了我个人设计温控仪的目标：

| 目标                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| 具有相当宽的工作范围 | **A1**的熔点是131-133 °C，而**B1**的熔点是72-74 °C，未来可能会在其他温度下工作。 ！！此处需要引用文献与实验数据 |
| 控温稳定             | 根据Stokes-Einstein方程，$D=kT/8\pi\eta r^3$,分子的扩散常数与温度线性相关，应尽可能减小温度震荡范围。 |
| 价格合适             | 不应当超出本科生科研的预算，否则不如外包。                   |
| 高度模块化           | 适合未来的改造。                                             |
| 便于操作             | 希望能从计算机而非仪器上操作，更进一步地提供数据监测、报警等功能。 |

这些目标涉及到了各方面的技术细节，市场上也无法直接购得完成的元件，所以我决定由简入繁，逐步迭代我的温控仪。

### 温控仪 v1.0

最简单的温控仪就是一个温控开关，加一个电源，加一个负载。温控装置 v1.0就是这样的一个温控仪。

![image-20210305000755900](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210305000755900.png)

<center><font color="gray">↑ 第一代温控仪  ！！图需要优化
    </p></font></center>

温控仪v1.0有一个显著的问题，就是温控装置为到设定温度前满载、到达后直接关闭的温度开关，这样粗暴的结构导致满载运行时功率过高容易引起电源频繁跳电，而时断时开的装置既不利于装置的长期运行，且难以达到精确的控温效果，温度跳动在$\pm 30 °C$，完全不适合实验使用。

![微信图片_20210305000909](https://gitee.com/DF-Master/yidapicbed/raw/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210305000909.jpg)

<center><font color="gray">↑ 第一代加热元件  ！！图需要优化
    </p></font></center>

不过，温控仪v1.0中，我也取得了一些成果：

- 首先，我实现了负载切换的模块化，也验证了12 mm环形加热片是最适合我们实验要求的加热元件。！！此处需要补充
- 此外，我也注意到了另一个问题，就是实验用的样品池为铝制品，当温度较高时，十分难以持握，危险程度较高。 为此，我设计了最高耐1000 °C的玻璃树脂纤维隔热模具。在实际内部样品池高达180 °C时，也可以直接裸手持握。

![image-20210305002607466](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210305002607466.png)

<center><font color="gray">↑ FTIR耐高温绝缘保温玻璃树脂纤维模具设计图
    </p></font></center>

接下来，我将目标放在了温控装置的优化上，淘宝上能低价选购到的温控装置多为粗暴的直接开断式温控开关，我通过联系[余姚精创仪表有限公司](http://www.tempinst.com/index.asp)，购得了一台具有PID功能的温控装置KCMR-6温控装置。

## PID控制器

PID（**P**roportional **I**ntegral **D**erivative）是什么？约翰·美斯菲尔德说：“我只要一艘船，和一颗为她掌舵的星。”但用人眼来掌舵是有极限的，PID控制器最早就源自于船舶的自动操作系统。

19世纪初，俄裔美国工程师米诺尔斯基在设计美国海军的自动操作系统时应用了它，当时的PID控制器在新墨西哥号战舰上进行测试，通过控制舵的角速度，可以使角度误差维持在$\pm2 ^\circ$以内，加上D控制后，角度误差维持在$\pm1/6 ^\circ$，这比当时最好的舵手还要好。

从下面这张图我们也可以看出，PID可以通过反馈系统使体系不断地逼近设定值，实现相当稳定的控制：

![img](https://gitee.com/DF-Master/yidapicbed/raw/master/Change_with_Kd.png)

<center><font color="gray">↑ PID虚拟实验模拟图。 ！！需要替换为我的matlab实验结果图
    </p></font></center>

那么，PID究竟是如何实现的过程呢？若要探求其具体原理，需要涉及到数学物理方法的内容，下面我只简要介绍其应用时涉及到的主要参数：

${\mathrm  {u}}(t)={\mathrm  {MV}}(t)=K_{p}{e(t)}+K_{i}\int _{0}^{t}{e(\tau )}\,{d\tau }+K_{d}{\frac  {d}{dt}}e(t)$


其中：

${\displaystyle K_{p}}$：比例增益，是调适参数
${\displaystyle K_{i}}$：积分增益，也是调适参数
${\displaystyle K_{d}}$：微分增益，也是调适参数
${\displaystyle e}$：误差=设定值（SP）- 回授值（PV）
${\displaystyle t}$：目前时间
${\displaystyle \tau }$：积分变数，数值从0到目前时间$${\displaystyle t}$$

### 比例（**P**）控件

比例控制考虑当前误差，误差值和一个正值的常数${\displaystyle K_{p}}$（表示比例）相乘。${\displaystyle K_{p}}$只是在控制器的输出和系统的误差成比例的时候成立。比如说，一个电热器控制器是在目标温度和实际温度差10°C时有100%的输出，而其目标值是25°C。那么它在15°C的时候会输出100%，在20°C的时候会输出50%，在24°C的时候输出10％，注意在误差是0的时候，控制器的输出也是0。

比例控制的输出如下：

$P_{\mathrm  {out}}=K_{p}\,{e(t)}$

若比例增益大，在相同误差量下，会有较大的输出，但若比例增益太大，会使系统不稳定。相反的，若比例增益小，若在相同误差量下，其输出较小，因此控制器会较不敏感的。若比例增益太小，当有干扰出现时，其控制信号可能不够大，无法修正干扰的影响。

### 积分(**I**)控件

积分控制考虑过去误差，将误差值过去一段时间和（误差和）乘以一个正值的常数${\displaystyle K_{i}}$。${\displaystyle K_{i}}$从过去的平均误差值来找到系统的输出结果和预定值的平均误差。一个简单的比例系统会震荡，会在预定值的附近来回变化，因为系统无法消除多余的纠正。通过加上负的平均误差值，平均系统误差值就会渐渐减少。所以，最终这个PID回路系统会在设定值稳定下来。

积分控制的输出如下：

$I_{\mathrm  {out}}=K_{i}\int _{0}^{t}{e(\tau )}\,{d\tau }$

积分控制会加速系统趋近设定值的过程，并且消除纯比例控制器会出现的稳态误差。积分增益越大，趋近设定值的速度越快，不过因为积分控制会累计过去所有的误差，可能会使回授值出现过冲的情形。

### 微分(**D**)控件

微分控制考虑将来误差，计算误差的一阶导，并和一个正值的常数${\displaystyle K_{d}}$相乘。这个导数的控制会对系统的改变作出反应。导数的结果越大，那么控制系统就对输出结果作出更快速的反应。这个${\displaystyle K_{d}}$参数也是PID被称为可预测的控制器的原因。${\displaystyle K_{d}}$参数对减少控制器短期的改变很有帮助。一些实际中的速度缓慢的系统可以不需要${\displaystyle K_{d}}$参数。

微分控制的输出如下：

${\displaystyle D_{\mathrm {out} }=K_{d}{\frac {d}{dt}}e(t)}D_{\mathrm  {out}}=K_{d}{\frac  {d}{dt}}e(t)$

微分控制可以提升整定时间及系统稳定性。不过因为纯微分器不是因果系统，因此在PID系统实现时，一般会为微分控制加上一个低通滤波器以限制高频增益及噪声。实际上较少用到微分控制，估计PID控制器中只有约20 %有用到微分控制

### 实测

那么，PID真的那么有效吗？我用寝室中的玻璃杯中的一杯麦片进行了一个小实验，结果如下：

![image-20210305011329003](https://gitee.com/DF-Master/yidapicbed/raw/master/image-20210305011329003.png)

<center><font color="gray">↑ 数据很丑，图也很丑，我也很丑，但我不想熬夜画图了，我想睡觉，睡觉才能让我不丑
    </p></font></center>

可以看出（此处应有分析，但因为我实验做的不是很好，就等0305晚上重新再做一遍实验吧）

不过，在实际使用时，P = 0， I =500，D = 100的设置已经能让样品池温度控制在$\pm 0.1 °C$了，这主要还是因为寝室里面干扰较大，而样品池在实验室的隔热模具内干扰较小。

### 温控器v2.0 

睡了睡了，明天再写。





# 引文

此处应有引文。

# 致谢

此处应有致谢。

# 附录

> 当每个人雕刻石材、竖起石柱、切开琉璃时，我们知道我们在建造一个比我们自己大的多的东西。——伍冰枝

## 我的工具

<span id='我的工具'>因为我技术水平比较低，以下的工具基本都是基于windows10的。</span>

此处应有10086个工具，但我摸了。之后更新。